<!doctype html>
<html>
    <head>
        <link rel=stylesheet href=bootstrap.css>
        <style>
            #search-options {
                background-color: #eee;
                padding: 7px 0; text-shadow: 0 0 1px #fff;
                margin-bottom: 20px;
                border-bottom: 1px solid #ccc;
            } 
            #search-options form { margin-top: 0; margin-bottom: 0; padding: 0; }
            #search-options label { margin-bottom: 0; }
            #search-options input { margin-top: 0; }
            p { width: 400px; font-size: 16px; line-height: 22px; }
            label { margin-right: 10px; float: none; display: inline}
            
            .highlight {
                background-color: #fefc7f;
                border-radius: 5px;
                box-shadow: 0 0 1px #ecec37, 0 2px 3px #eee;
            }
        </style>
    </head>
    <body>
        <div id=search-options>
            <form class="form-inline container">
                <label>Search <input id=search type=text value=lorem></label>
                <label>Highlight <input id=highlight checked type=checkbox></label>
                <label>Fade <input id=fade checked type=checkbox></label>
                <label>Hide <input id=hide type=checkbox></label>
            </form>
        </div>

        <div class=container>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla magna diam, mattis nec adipiscing vel, auctor eleifend felis. Mauris cursus erat sollicitudin metus feugiat eget ullamcorper felis vestibulum.</p>

            <p>Phasellus lobortis sollicitudin diam quis tempus. Proin egestas vehicula sem a elementum.</p>

            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed faucibus porta odio id vehicula. Curabitur suscipit, lorem sit amet condimentum tincidunt, libero ipsum malesuada leo, ultrices mollis libero tellus nec ante.</p>

            <p>Quisque lacinia facilisis mollis.</p>

            <p>Sed nec lacus ut ante interdum cursus non sit amet risus. Curabitur id neque ac lorem accumsan rutrum. Donec mi tortor, viverra sit amet lacinia nec, bibendum a augue.</p>

            <p>Nulla facilisis, neque placerat tempor bibendum, ligula lectus pharetra purus, eget porttitor quam eros et ipsum. Nunc eu metus nisl.</p>

            <p>Cras nisl elit, laoreet et luctus non, ultricies quis magna. Phasellus consectetur magna id dui sagittis et laoreet elit adipiscing.</p>

            <p>Phasellus lobortis gravida diam quis lobortis. Nunc nec convallis libero. Etiam vel velit arcu, vel ullamcorper urna. Praesent posuere justo in justo aliquet id dignissim purus vulputate. Ut leo nisl, venenatis vel dictum in, eleifend at justo. Etiam cursus, mauris at cursus sodales, dolor erat ullamcorper neque, non blandit lacus nibh a felis. Quisque et arcu eu velit blandit porttitor.</p>
        </div>

        <script src=jquery.js></script>
        <script src=jquery.highlight.js></script>
        <script src=jquery.regexp-expr.js></script>

        <script>
            $(function() {

                var hits = $(),
                    misses = $(),
                    elems = $('p');

                var fader = $('#fade'),
                    hider = $('#hide'),
                    highlighter = $('#highlight'),
                    search = $('#search');

                var newValue, lastValue = null;

                function domTextSearch() {
                    newValue = search.val();
                    // Nothing changed..
                    if (newValue === lastValue) return;
                    // Update last value
                    lastValue = newValue;

                    // Ensure it's not empty
                    if (!!newValue) {
                        hits = elems.filter(':regex(' + search.val() + ')');
                        misses = elems.not(hits);
                    } else {
                        hits = $();
                        misses = $();
                    }

                    // Toggle (update) all downstream effects
                    toggleFade(newValue);
                    toggleHide(newValue);
                    toggleHighlight(newValue);
                }

                function toggleFade() {
                    if (fader.prop('checked')) {
                        elems.css({ opacity: 1 });
                        misses.css({ opacity: 0.1 });
                    } else {
                        misses.css({ opacity: 1 });
                    }
                }

                function toggleHide() {
                    if (hider.prop('checked')) {
                        elems.show();
                        misses.hide();
                    } else {
                        misses.show();
                    }
                }

                function toggleHighlight() {
                    if (highlighter.prop('checked')) {
                        elems.removeHighlight();
                        hits.highlight(newValue);
                    } else {
                        hits.removeHighlight();
                    }
                }

                search.on('keyup', domTextSearch);
                fader.on('click', toggleFade);
                hider.on('click', toggleHide);
                highlighter.on('click', toggleHighlight);

                domTextSearch();

            });
        </script>
    </body>
</html>
