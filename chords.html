<!doctype html>
<html>
    <head>
        <link rel=stylesheet href=bootstrap.css>
        <link rel=stylesheet href=style.css>
    </head>
    <body>
        <div id=search-options>
            <form class="form-inline container">
                <label>Search <input id=search type=text value=min></label>
                <label>Highlight <input id=highlight type=checkbox></label>
                <label>Fade <input id=fade checked type=checkbox></label>
                <label>Hide <input id=hide type=checkbox></label>
            </form>
        </div>

        <div class=container>
            <img src=chords/chord_amin95.gif data-search=Amin9>
            <img src=chords/chord_amin96.gif data-search=Amin9>
            <img src=chords/chord_asus2_open.gif data-search=Asus2>
            <img src=chords/chord_b55.gif data-search=B5>
            <img src=chords/chord_cmin95.gif data-search=Cmin9>
            <img src=chords/chord_d7sus2_open.gif data-search=D7sus2>
            <img src=chords/chord_dmaj7_open.gif data-search=Dmaj7>
            <img src=chords/chord_e9_open.gif data-search=E9>
            <img src=chords/chord_eb7sus45.gif data-search=Eb7sus4>
            <img src=chords/chord_fmaj66.gif data-search=F6>
        </div>

        <script src=jquery.js></script>
        <script src=jquery.highlight.js></script>
        <script src=jquery.regexp-expr.js></script>

        <script>
            $(function() {

                var hits = $(),
                    misses = $(),
                    elems = $('img');

                var fader = $('#fade'),
                    hider = $('#hide'),
                    highlighter = $('#highlight'),
                    search = $('#search');

                var newValue, lastValue = null;

                function domTextSearch() {
                    newValue = search.val();
                    // Nothing changed..
                    if (newValue === lastValue) return;
                    // Update last value
                    lastValue = newValue;

                    // Ensure it's not empty
                    if (!!newValue) {
                        hits = elems.filter(function(idx) {
                            var metadata = $(this).data('search');
                            return metadata && metadata.search(new RegExp(newValue, 'ig')) >= 0;
                        });
                        misses = elems.not(hits);
                    } else {
                        hits = $();
                        misses = $();
                    }

                    // Toggle (update) all downstream effects
                    toggleFade(newValue);
                    toggleHide(newValue);
                    toggleHighlight(newValue);
                }

                function toggleFade() {
                    if (fader.prop('checked')) {
                        elems.css({ opacity: 1 });
                        misses.css({ opacity: 0.1 });
                    } else {
                        misses.css({ opacity: 1 });
                    }
                }

                function toggleHide() {
                    if (hider.prop('checked')) {
                        elems.show();
                        misses.hide();
                    } else {
                        misses.show();
                    }
                }

                function toggleHighlight() {
                    if (highlighter.prop('checked')) {
                        elems.removeHighlight();
                        hits.highlight(newValue);
                    } else {
                        hits.removeHighlight();
                    }
                }

                search.on('keyup', domTextSearch);
                fader.on('click', toggleFade);
                hider.on('click', toggleHide);
                highlighter.on('click', toggleHighlight);

                domTextSearch();

            });
        </script>
    </body>
</html>
